<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>

   <extension
         id="com.aobuchow.sample.commander.fragment"
         point="org.eclipse.e4.workbench.model">
      <fragment
            apply="notexists"
            uri="fragment.e4xmi">
      </fragment>
   </extension>
   <extension
         point="org.eclipse.core.contenttype.contentTypes">
      <content-type
            file-extensions=".mp3, .wav, .flac"
            id="com.aobuchow.sample.commander.content.type.audioFile"
            name="Audio File"
            priority="high">
      </content-type>
   </extension>
   <extension
         point="org.eclipse.core.expressions.definitions">
      <definition
            id="org.eclipse.ui.ide.showInDefinition">
            <or>
            <with variable="selection">
                    <count value="1" />
                    <iterate ifEmpty="false">
                        <adapt type="org.eclipse.core.resources.IFolder" />
                    </iterate>
             </with>
            <with
                  variable="activePart">
               <test
                     property="org.eclipse.ui.ide.editor.input">
               </test>
            </with>
            <with
                  variable="activeShell">
               <test
                     property="org.eclipse.ui.ide.page.activePreferencePage"
                     value="org.eclipse.ui.internal.ide.dialogs.ResourceInfoPage">
               </test>
            </with>
             </or>
      </definition>
   </extension>
   <extension
         point="org.eclipse.ui.editors">
      <editor
            class="com.aobuchow.sample.commander.editor.FileManagerEditor"
            contributorClass="com.aobuchow.sample.commander.editor.FileManagerActionBar"
            default="true"
            extensions="mp3, wav"
            icon="icons/AudioFile3_16.png"
            id="com.aobuchow.sample.commander.editor1"
            matchingStrategy="com.aobuchow.sample.commander.editor.FileManagerMatchingStrategy"
            name="File Manager">
         <contentTypeBinding
               contentTypeId="com.aobuchow.sample.commander.content.type.audioFile">
         </contentTypeBinding>
      </editor>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            class="com.aobuchow.sample.commander.handlers.DeleteHandler"
            commandId="org.eclipse.ui.edit.delete">
         <activeWhen>
			<with variable="activeEditorId">
       			 <equals value="com.aobuchow.sample.commander.editor1"/>
   			 </with>         
   		</activeWhen>
         <class
               class="com.aobuchow.sample.commander.handlers.DeleteHandler">
         </class>
      </handler>
      <handler
            class="com.aobuchow.sample.commander.handlers.CopyHandler"
            commandId="org.eclipse.ui.edit.copy">
         <class
               class="com.aobuchow.sample.commander.handlers.CopyHandler">
         </class>
         <activeWhen>
            <and>
               <with
                     variable="activeEditorId">
                  <equals
                        value="com.aobuchow.sample.commander.editor1">
                  </equals>
               </with>
               <iterate>
                  <instanceof
                        value="org.eclipse.core.resources.IResource">
                  </instanceof>
               </iterate>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="com.aobuchow.sample.commander.handlers.PasteHandler"
            commandId="org.eclipse.ui.edit.paste">
         <activeWhen>
            <with
                  variable="activeEditorId">
               <equals
                     value="com.aobuchow.sample.commander.editor1">
               </equals>
            </with>
         </activeWhen>
         <class
               class="com.aobuchow.sample.commander.handlers.DeleteHandler">
         </class>
      </handler>
      <handler
            class="com.aobuchow.sample.commander.handlers.UndoHandler"
            commandId="org.eclipse.ui.edit.undo">
         <activeWhen>
            <with
                  variable="activeEditorId">
               <equals
                     value="com.aobuchow.sample.commander.editor1">
               </equals>
            </with>
         </activeWhen>
         <class
               class="com.aobuchow.sample.commander.handlers.UndoHandler">
         </class>
      </handler>
      <handler
            class="com.aobuchow.sample.commander.handlers.RedoHandler"
            commandId="org.eclipse.ui.edit.redo">
         <activeWhen>
            <with
                  variable="activeEditorId">
               <equals
                     value="com.aobuchow.sample.commander.editor1">
               </equals>
            </with>
         </activeWhen>
         <class
               class="com.aobuchow.sample.commander.handlers.RedoHandler">
         </class>
      </handler>
      <handler
            class="com.aobuchow.sample.commander.handlers.CutHandler"
            commandId="org.eclipse.ui.edit.cut">
         <activeWhen>
         <and>
            <with
                  variable="activeEditorId">
               <equals
                     value="com.aobuchow.sample.commander.editor1">
               </equals>
            </with>
         <iterate>
            <instanceof
                  value="org.eclipse.core.resources.IResource">
            </instanceof>
         </iterate>
         </and>
         </activeWhen>
         <class
               class="com.aobuchow.sample.commander.handlers.CutHandler">
         </class>
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.elementFactories">
      <factory
            class="com.aobuchow.sample.commander.editor.ContainerEditorInputFactory"
            id="com.aobuchow.sample.commander.editor.ContainerEditorInputFactory">
      </factory>
   </extension>
   <extension
         point="org.eclipse.ui.editors.documentProviders">
      <provider
            class="com.aobuchow.sample.commander.editor.ContainerEditorInput"
            id="com.aobuchow.sample.commander.ContainerEditorInput">
      </provider>
   </extension>
   <extension
         point="org.eclipse.core.runtime.adapters">
      <factory
            adaptableType="com.aobuchow.sample.commander.editor.IContainerEditorInput"
            class="com.aobuchow.sample.commander.editor.ContainerInputFactory">
         <adapter
               type="org.eclipse.core.resources.IFolder">
         </adapter>
         <adapter
               type="org.eclipse.core.resources.IResource">
         </adapter>
      </factory>
   </extension>
   <extension
         point="org.eclipse.core.expressions.propertyTesters">
      <propertyTester
            class="com.aobuchow.sample.commander.editor.ContainerEditorInputTester"
            id="org.eclipse.ui.ide.containerEditorInputTester"
            namespace="org.eclipse.ui.ide.editor"
            properties="input"
            type="org.eclipse.ui.IWorkbenchPart">
      </propertyTester>
   </extension>
   <extension
         point="org.eclipse.ui.menus">
<menuContribution
            locationURI="popup:org.eclipse.ui.menus.showInMenu">
          <command
             commandId="com.aobuchow.sample.commander.commands.openContainerResource"
             label="File Manager"
             mnemonic=""
             icon="icons/AudioFile3_16.png"
             style="push">
          <visibleWhen
                checkEnabled="false">
             <reference
                   definitionId="org.eclipse.ui.ide.showInDefinition">
             </reference>
          </visibleWhen>
         </command>
      </menuContribution>
   </extension>
   <extension
         point="org.eclipse.ui.commands">
      <command
            name="Open Folder"
            description="Open a Folder in a Sample Commander File Manager"
            categoryId="org.eclipse.ui.category.navigate"
            id="com.aobuchow.sample.commander.commands.openContainerResource"
            defaultHandler="com.aobuchow.sample.commander.handlers.OpenResourceHandler">
         <commandParameter
               id="org.eclipse.ui.ide.showInSystemExplorer.path"
               name="%commandParameter.resourceSystemPath"
               typeId="org.eclipse.ui.ide.resourcePath">
         </commandParameter>
      </command>
   </extension>
   <extension
         point="org.eclipse.ui.navigator.linkHelper">
      <linkHelper
            class="com.aobuchow.sample.commander.editor.ContainerLinkHelper"
            id="com.aobuchow.sample.commander.containerLinkHelper">
         <editorInputEnablement>
            <with variable="selection">
                    <count value="1" />
                    <iterate ifEmpty="false">
                       <or>
                          <adapt
                                type="org.eclipse.core.resources.IFolder">
                          </adapt>
                          <adapt
                                type="org.eclipse.core.resources.IFile">
                          </adapt>
                       </or>
                    </iterate>
             </with></editorInputEnablement>
         <selectionEnablement>
          <with variable="selection">
                    <count value="1" />
                    <iterate ifEmpty="false">
                       <or>
                          <adapt
                                type="org.eclipse.core.resources.IFolder">
                          </adapt>
                          <adapt
                                type="org.eclipse.core.resources.IFile">
                          </adapt>
                       </or>
                    </iterate>
             </with></selectionEnablement>
      </linkHelper>
   </extension>
   <extension
         point="org.eclipse.ui.navigator.viewer">
      <viewerContentBinding
            viewerId="org.eclipse.ui.navigator.ProjectExplorer">
         <includes>
            <contentExtension
                  pattern="com.aobuchow.sample.commander.containerLinkHelper">
            </contentExtension>
         </includes>
      </viewerContentBinding>
   </extension>

</plugin>
